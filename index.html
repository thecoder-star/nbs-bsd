<!DOCTYPE html>
<html lang="en">
<head>
    <base href="https://cdn.jsdelivr.net/gh/gn-math/gn-math.github.io@main/">
    <link rel="icon" type="image/png" href="https://pbs.twimg.com/profile_images/1676663837423194112/yw0xwYoT_400x400.jpg">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bsd-nb | v2.1</title>
    
    <style>
        /* UI & AUTH STYLES */
        :root { 
            --primary: #44f00f; 
            --bg: #0f172a; 
            --text: #f1f5f9; 
            --surface: #1e293b; 
            --border: #334155; 
            --radius-lg: 16px; 
            --gradient-primary: linear-gradient(135deg, #1bf05bfb 0%, #ff4d75 100%); 
        }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; overflow-x: hidden; }
        
        #passwordScreen { position: fixed; inset: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; z-index: 10000; }
        .password-box { background: rgba(255, 255, 255, 0.95); border-radius: 20px; padding: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); max-width: 400px; width: 90%; text-align: center; color: #333; }
        .password-box input { width: 100%; padding: 15px; margin-bottom: 15px; border: 2px solid #e0e0e0; border-radius: 10px; box-sizing: border-box; }
        .password-box button { width: 100%; padding: 15px; background: #667eea; color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; }

        header { background: var(--gradient-primary); padding: 1rem; position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .header-content { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; gap: 15px; }
        
        .search-container { display: flex; gap: 10px; flex: 1; max-width: 600px; }
        #searchBar { padding: 12px; border-radius: 8px; border: none; flex: 2; background: rgba(255,255,255,0.2); color: white; outline: none; }
        #searchBar::placeholder { color: rgba(255,255,255,0.7); }

        /* GAME GRID */
        #container, #featuredZones { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 1.5rem; padding: 20px; }
        .zone-item { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-lg); overflow: hidden; cursor: pointer; transition: 0.3s ease; position: relative; }
        .zone-item:hover { transform: translateY(-8px); border-color: var(--primary); box-shadow: 0 10px 20px rgba(0,0,0,0.4); }
        .zone-item img { width: 100%; aspect-ratio: 1; object-fit: cover; }
        .zone-item .info { padding: 12px; text-align: center; font-weight: bold; font-size: 0.9rem; }

        /* MODALS */
        #changelogModal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 2000; display: none; align-items: center; justify-content: center; }
        .modal-content { background: var(--surface); padding: 30px; border-radius: 20px; max-width: 500px; width: 90%; border: 1px solid var(--primary); }

        #zoneViewer { position: fixed; inset: 0; background: #000; z-index: 3000; display: none; flex-direction: column; }
        #zoneFrame { flex-grow: 1; border: none; width: 100%; height: 100%; }
        .zone-header { background: #1a1a1a; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; color: white; }
        
        .btn-action { padding: 8px 16px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-close { background: #ff4d4d; color: white; }
        .btn-tab { background: var(--primary); color: #000; margin-right: 10px; }
        
        .content-hidden { display: none !important; }
        hr { border: 0; border-top: 1px solid var(--border); margin: 20px; }
    </style>
</head>
<body>

    <div id="passwordScreen" class="content-hidden">
        <div class="password-box">
            <h1 style="margin-top:0">üéÆ restricted</h1>
            <p>Please enter the access key</p>
            <input type="password" id="passwordInput" placeholder="Password...">
            <button onclick="checkPassword()">Verify Access</button>
            <p id="passwordError" style="color: #ff4d4d; margin-top: 10px; font-weight: bold;"></p>
        </div>
    </div>

    <div id="changelogModal">
        <div class="modal-content">
            <h2 style="color: var(--primary); margin-top: 0;">üöÄ What's New?</h2>
            <div id="changelogBody" style="line-height: 1.6; margin-bottom: 20px;">
                </div>
            <button class="btn-action" style="width: 100%; background: var(--primary);" onclick="closeChangelog()">Got it!</button>
        </div>
    </div>

    <div id="mainContent" class="content-hidden">
        <header>
            <div class="header-content">
                <div style="font-weight:900; letter-spacing:-1px; font-size:1.4rem">lowk was easy</div>
                <div class="search-container">
                    <input type="text" id="searchBar" placeholder="Search for a game..." oninput="filterZones()">
                </div>
                <button onclick="logout()" style="background:none; color:white; border:1px solid rgba(255,255,255,0.3); padding:8px 12px; border-radius:6px; cursor:pointer;">Logout</button>
            </div>
        </header>

        <main style="max-width: 1200px; margin: auto; padding-bottom: 100px;">
            <h2 style="padding: 20px 20px 0; color: var(--primary)">‚≠ê Featured</h2>
            <div id="featuredZones"></div>
            <hr>
            <h2 style="padding: 0 20px;">üìÇ Library</h2>
            <div id="container">Loading components...</div>
        </main>
    </div>

    <div id="zoneViewer">
        <div class="zone-header">
            <span id="activeGameTitle" style="font-weight: bold; font-size: 1.1rem;">Game</span>
            <div>
                <button class="btn-action btn-tab" onclick="openInNewTab()">Open in New Tab</button>
                <button class="btn-action btn-close" onclick="closeZone()">Close</button>
            </div>
        </div>
        <iframe id="zoneFrame"></iframe>
    </div>

    <script>
        const CONFIG = {
            DEFAULT_PASS: 'unblockedproxyjet',
            ZONES_JSON: "https://cdn.jsdelivr.net/gh/gn-math/assets@main/zones.json",
            COVER_BASE: "https://cdn.jsdelivr.net/gh/gn-math/covers@main",
            HTML_BASE: "https://cdn.jsdelivr.net/gh/gn-math/html@main"
        };

        let allGames = [];
        let currentGameUrl = "";

        // --- AUTH LOGIC ---
        function checkPassword() {
            const input = document.getElementById('passwordInput').value;
            const correct = localStorage.getItem('gamePassword') || CONFIG.DEFAULT_PASS;
            if (input === correct) {
                sessionStorage.setItem('isAuthed', 'true');
                location.reload();
            } else {
                document.getElementById('passwordError').textContent = "Access Denied.";
            }
        }

        function logout() {
            sessionStorage.clear();
            location.reload();
        }

        // --- GAME LOGIC ---
        async function fetchGames() {
            try {
                const res = await fetch(CONFIG.ZONES_JSON + "?v=" + Date.now());
                allGames = await res.json();
                renderGrids(allGames);
                checkChangelog();
            } catch (err) {
                document.getElementById('container').innerText = "Critical error loading data.";
            }
        }

        function renderGrids(data) {
            const container = document.getElementById('container');
            const featured = document.getElementById('featuredZones');
            container.innerHTML = "";
            featured.innerHTML = "";

            data.forEach((game, index) => {
                const card = createCard(game);
                container.appendChild(card);
                if (game.featured || index < 4) {
                    featured.appendChild(card.cloneNode(true));
                }
            });
            
            // Re-attach listeners to cloned nodes
            document.querySelectorAll('.zone-item').forEach((item, idx) => {
                const gameName = item.querySelector('.info').innerText;
                const gameObj = allGames.find(g => g.name === gameName);
                item.onclick = () => launchGame(gameObj);
            });
        }

        function createCard(game) {
            const div = document.createElement('div');
            div.className = "zone-item";
            const img = game.cover.replace("{COVER_URL}", CONFIG.COVER_BASE);
            div.innerHTML = `<img src="${img}"><div class="info">${game.name}</div>`;
            return div;
        }

        function launchGame(game) {
            const viewer = document.getElementById('zoneViewer');
            const frame = document.getElementById('zoneFrame');
            currentGameUrl = game.url.replace("{HTML_URL}", CONFIG.HTML_BASE);
            
            document.getElementById('activeGameTitle').innerText = game.name;
            frame.src = currentGameUrl;
            viewer.style.display = "flex";
            document.body.style.overflow = "hidden";
        }

        function closeZone() {
            document.getElementById('zoneViewer').style.display = "none";
            document.getElementById('zoneFrame').src = "";
            document.body.style.overflow = "auto";
        }

        function openInNewTab() {
            if (currentGameUrl) window.open(currentGameUrl, '_blank');
        }

        function filterZones() {
            const query = document.getElementById('searchBar').value.toLowerCase();
            const filtered = allGames.filter(g => g.name.toLowerCase().includes(query));
            renderGrids(filtered);
        }

        // --- CHANGELOG LOGIC ---
        function checkChangelog() {
            const lastSeen = localStorage.getItem('lastChangelogSeen');
            const currentContent = localStorage.getItem('adminChangelog') || "Welcome to the new dashboard!";
            
            if (lastSeen !== currentContent) {
                document.getElementById('changelogBody').innerHTML = currentContent;
                document.getElementById('changelogModal').style.display = "flex";
            }
        }

        function closeChangelog() {
            const currentContent = localStorage.getItem('adminChangelog') || "Welcome to the new dashboard!";
            localStorage.setItem('lastChangelogSeen', currentContent);
            document.getElementById('changelogModal').style.display = "none";
        }

        // --- INIT ---
        window.onload = () => {
            if (sessionStorage.getItem('isAuthed') === 'true') {
                document.getElementById('mainContent').classList.remove('content-hidden');
                fetchGames();
            } else {
                document.getElementById('passwordScreen').classList.remove('content-hidden');
            }
        };
    </script>
</body>
</html>
